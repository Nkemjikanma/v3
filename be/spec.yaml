#! spec.yaml 

name: be

# `fra` - stands for Frankfurt
region: fra
services:
  - name: be
    # Relative to source_dir
    dockerfile_path: Dockerfile
    source_dir: be
    github: 
      branch: main 
      deploy_on_push: true
      repo: nkemjikanma/v3
    health_check: 
      http_path: /api
    # The port application will be listening on
    http_port: 8000
    # for production workload, we should get 2 but let's keep bills down 
    instance_count: 1
    instance_size_slug: basic-xxs
    # All incoming requests should be routed to our app
    routes:
      - path: /
    envs:
      - key: APP_ENV
        scope: RUN_TIME
        value: "production"
      - key: APP_PORT
        scope: RUN_TIME
        value: "8000"
        # Database env vars - references the 'bedb' database component
      - key: DB_HOST
        scope: RUN_TIME
        value: ${bedb.HOSTNAME}
      - key: DB_PORT
        scope: RUN_TIME
        value: ${bedb.PORT}
      - key: DB_USERNAME
        scope: RUN_TIME
        value: ${bedb.USERNAME}
      - key: DB_PASSWORD
        scope: RUN_TIME
        value: ${bedb.PASSWORD}
        type: SECRET
      - key: DB_NAME
        scope: RUN_TIME
        value: ${bedb.DATABASE}
databases:
  - engine: PG
    name: bedb
    num_nodes: 1
    size: db-s-dev-database
    version: "17" 
